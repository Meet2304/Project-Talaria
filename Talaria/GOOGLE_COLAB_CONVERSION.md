# Google Colab Notebook for Model Conversion
# Copy this entire code into a new Google Colab notebook

## Cell 1: Install TensorFlow.js converter
```python
!pip install tensorflowjs==4.12.0
```

## Cell 2: Upload your model file
```python
from google.colab import files
import os

# Click "Choose Files" and select your lstm_sensor_model.h5
uploaded = files.upload()

# Check upload
for filename in uploaded.keys():
    print(f'✅ Uploaded: {filename} ({len(uploaded[filename])} bytes)')
```

## Cell 3: Convert to TensorFlow.js format
```python
!tensorflowjs_converter \
  --input_format=keras \
  --output_format=tfjs_layers_model \
  lstm_sensor_model.h5 \
  tfjs_output

print("\n✅ Conversion complete!")
print("\nGenerated files:")
!ls -lh tfjs_output/
```

## Cell 4: Verify conversion
```python
import json

# Load and inspect model.json
with open('tfjs_output/model.json', 'r') as f:
    model_json = json.load(f)

print("Model format:", model_json.get('format'))
print("Generated by:", model_json.get('generatedBy'))
print("Converted by:", model_json.get('convertedBy'))

# Count layers
if 'modelTopology' in model_json:
    config = model_json['modelTopology']['model_config']['config']
    if 'layers' in config:
        layers = config['layers']
        print(f"\n✅ Total layers: {len(layers)}")
        
        # Count LSTM layers
        lstm_count = sum(1 for layer in layers if layer['class_name'] == 'LSTM')
        print(f"✅ LSTM layers: {lstm_count} (should be 3)")
        
        # List all layers
        print("\nLayer structure:")
        for i, layer in enumerate(layers, 1):
            name = layer.get('name') or layer.get('config', {}).get('name', 'unnamed')
            class_name = layer['class_name']
            print(f"  {i}. {name:20s} ({class_name})")
            
# Check weights
if 'weightsManifest' in model_json:
    weights = model_json['weightsManifest'][0]['weights']
    print(f"\n✅ Weight tensors: {len(weights)} (should be 13)")
    print("\nWeight details:")
    for w in weights:
        print(f"  {w['name']:50s} shape: {w['shape']}")
```

## Cell 5: Download the converted files
```python
from google.colab import files
import shutil

# Create a zip file
shutil.make_archive('tfjs_model', 'zip', 'tfjs_output')

# Download
files.download('tfjs_model.zip')

print("✅ Download started!")
print("\nNext steps:")
print("1. Extract tfjs_model.zip on your computer")
print("2. Copy model.json and .bin files to:")
print("   Talaria\\public\\models\\Talaria-LSTM-v2\\")
print("3. Restart your development server")
print("4. Test model loading in the Predictions page")
```

## Expected Output

After running all cells, you should see:
- ✅ Model format: layers-model
- ✅ LSTM layers: 3
- ✅ Weight tensors: 13
- ✅ Downloaded: tfjs_model.zip

## Layer Structure Should Be:
1. input                 (InputLayer)
2. lstm_1                (LSTM) - 128 units
3. dropout_1             (Dropout)
4. lstm_2                (LSTM) - 64 units
5. dropout_2             (Dropout)
6. lstm_3                (LSTM) - 32 units
7. dropout_3             (Dropout)
8. dense_1               (Dense) - 64 units
9. dropout_4             (Dropout)
10. output               (Dense) - 15 units

## Troubleshooting

**"Model not found" error:**
- Make sure you uploaded the file in Cell 2
- Check the filename is exactly `lstm_sensor_model.h5`

**Conversion fails:**
- Check error message
- Try: `!pip install tensorflow==2.15.0` before conversion

**Wrong number of layers:**
- Your original model might be different
- Check the layer names in Cell 4 output

**Download doesn't start:**
- Try: `!zip -r tfjs_model.zip tfjs_output/` then `files.download('tfjs_model.zip')`
- Or manually download files from Files tab in Colab sidebar

---

## Quick Link to Google Colab

1. Go to: https://colab.research.google.com/
2. Click: New Notebook
3. Copy code from each cell above
4. Run cells in order

**Estimated time: 5 minutes** ⏱️
